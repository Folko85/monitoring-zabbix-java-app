# User parameters for Spring Boot Actuator monitoring
# Generated by Ansible

# Получение всех метрик через /actuator/metrics
UserParameter=actuator.metrics[*],curl -s http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/$1 | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# Получение конкретной метрики с тегами
UserParameter=actuator.metric[*],curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/$1?tag=$2" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# Health check
UserParameter=actuator.health,curl -s http://{{ java_app_host }}:{{ java_app_port }}/actuator/health | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('status', 'UNKNOWN'))"

# JVM Memory - Heap Used
UserParameter=jvm.memory.heap.used,curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/jvm.memory.used?tag=area:heap" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# JVM Memory - Heap Max
UserParameter=jvm.memory.heap.max,curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/jvm.memory.max?tag=area:heap" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# JVM Memory - Non-Heap Used
UserParameter=jvm.memory.nonheap.used,curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/jvm.memory.used?tag=area:nonheap" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# JVM Threads - Live
UserParameter=jvm.threads.live,curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/jvm.threads.live" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# JVM Threads - Daemon
UserParameter=jvm.threads.daemon,curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/jvm.threads.daemon" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# GC Pause Time
UserParameter=jvm.gc.pause[*],curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/jvm.gc.pause?tag=action:end%20of%20minor%20GC" | python3 -c "import sys, json; data=json.load(sys.stdin); measurements=data.get('measurements', []); print(measurements[0].get('value', '0') if measurements else '0')"

# HTTP Server Requests - Total
UserParameter=http.server.requests.total,curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/http.server.requests" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# System CPU Usage
UserParameter=system.cpu.usage,curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/system.cpu.usage" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# Process CPU Usage
UserParameter=process.cpu.usage,curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/process.cpu.usage" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"

# Uptime
UserParameter=process.uptime,curl -s "http://{{ java_app_host }}:{{ java_app_port }}/actuator/metrics/process.uptime" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('measurements', [{}])[0].get('value', '0') if data.get('measurements') else '0')"
